---
title: "ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãŒå¤§äº‹ãªç†ç”±ã€ãã—ã¦Immerã§ç°¡å˜å®Ÿç¾ï¼"
emoji: "ğŸ”’"
type: "tech"
topics:
  - "react"
  - "redux"
published: true
published_at: "2021-01-22 17:37"
---

## å§‹ã‚
JS,ç‰¹ã«Reactã‚’å‹‰å¼·ã—ã¦ã‚‹ã¨ã‚ˆãimmutabilityã¨ã„ã†è¨€è‘‰ã‚’èãã¾ã™ã€‚æœ€è¿‘immerã‚’ä½¿ã£ã¦ã¿ã¦ä¸æ„ã«immutabilityã¯ä½•ã§é‡è¦ã ã£ãŸã£ã‘ï¼Ÿã¨æ€ã£ãŸã®ã§ã€æŠ•ç¨¿ã—ã¾ã™ã€‚

---

## 1. immutabilityã¨ã¯

immutabilityã¯ä¸å¤‰æ€§ã€ã¤ã¾ã‚Š**å¤‰ã‚ã‚‰ãªã„æ€§è³ª**ã¨ã„ã†è‹±å˜èªã§ã™ã€‚

ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã§ã®immutabilityã¯ã€Œ`state`ã‚’å¤‰æ›´ã—ãªã„ã“ã¨ã€ã¨ã‚‚è¨€ãˆã¾ã™ã€‚*(éŸ“å›½ã§ã¯æ¼¢å­—ã®æ–¹ã®ã€Œä¸å¤‰æ€§ã€ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ãŒã€æ—¥æœ¬èªã‚ã¾ã‚Šåˆ†ã‹ã‚‰ãªã„ã®ã§ä»Šå›ã¯è‹±å˜èªãã®ã¾ã¾æ›¸ãã¾ã™ã€‚)*

ã“ã“ã§ã€ã€Œ`state`ã‚’å¤‰æ›´ã™ã‚‹ã€ã¨ã„ã†ã“ã¨ã¯æ­£ç¢ºã«ä½•ã‚’æ„å‘³ã™ã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿä¸€ç•ªç°¡å˜ãªä¾‹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
```javascript
let greeting = "ãŠã¯ã‚ˆã†"
greeting = "ã•ã‚ˆãªã‚‰"
```
ã“ã®ã‚ˆã†ã«å†ä»£å…¥ã—ãŸã‚‰å¤‰æ•°ã®å€¤ãŒå¤‰ã‚ã‚‹ã®ã§ã€ç«‹æ´¾ãªã€Œ`state`ã‚’å¤‰æ›´ã™ã‚‹ã€è¡Œç‚ºã§ã™ã€‚ã ã£ãŸã‚‰å†ä»£å…¥ã—ãªã‘ã‚Œã°immutabilityå®ˆã‚Œã‚‹ã‚“ã ï¼ã¨æ€ã†ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€**é•ã„ã¾ã™**ã€‚

æ¬¡ã®ä¾‹ã§ã™ã€‚

```javascript
const string = "hello";
const makeUpperCase = (string) => string.toUpperCase();

console.log(makeUpperCase(string)); //HELLO
console.log(string); //hello
```
ã‚’å¼•æ•°ã§ã‚‚ã‚‰ã£ãŸ`string`ã‚’å¤‰æ›´ã—ã¦è¿”ã™é–¢æ•°ã§ã™ã€‚ç‰¹ã«å•é¡Œã¯ãªã•ãã†ã§ã™

```javascript
const array = ["ãŠã¯ã‚ˆã†", "hello"];
const addArray = (array) => {
  array.unshift("ì•ˆë…•");
  return array;
};

console.log(addArray(array)); // ["ì•ˆë…•", "ãŠã¯ã‚ˆã†", "hello"]
console.log(array); // ["ì•ˆë…•", "ãŠã¯ã‚ˆã†", "hello"]
```
å•é¡Œã¯ã“ã‚Œã§ã™ã€‚å¼•æ•°ã§ã‚‚ã‚‰ã£ãŸé…åˆ—ã«æ–°ã—ã„è¦ç´ ã‚’è¿½åŠ ã—ã¦è¿”ã™é–¢æ•°ã§ã™ãŒã€ã©ã“ã§ã‚‚å†ä»£å…¥ã¯ã—ã¦ãªã„ã®ã«`array`ã®å€¤ãŒå¤‰æ›´ã•ã‚Œã¦ã—ã¾ã„ã¾ã—ãŸã€‚ãã®ç†ç”±ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

é–¢æ•°ã«å¼•æ•°ã¨ã—ã¦å¤‰æ•°ã‚’æ¸¡ã™æ™‚ã¯ã€ãã®å¤‰æ•°ã®ã‚³ãƒ”ãƒ¼æœ¬ã‚’æ¸¡ã—ã¾ã™ã€‚

ã“ã“ã§ã€ãã®å¤‰æ•°ã®ä¸­èº«ãŒ**ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã‚¿ã‚¤ãƒ—**ãªã‚‰å€¤ã‚’æ–°ã—ã„ãƒ¡ãƒ¢ãƒªä¿å­˜ã—ã¦æ¸¡ã—ã¾ã™ã€‚ã§ã™ã®ã§ã€ã‚³ãƒ”ãƒ¼æœ¬ã‚’å¤‰æ›´ã—ã¦ã‚‚åŸæœ¬ã«ã¯å½±éŸ¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚

ã—ã‹ã—ã€å¤‰æ•°ã®ä¸­èº«ãŒ**ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¿ã‚¤ãƒ—**ãªã‚‰ãã®å¤‰æ•°ã®ãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ¸¡ã—ã¾ã™ã€‚åŸæœ¬ã¨ã‚³ãƒ”ãƒ¼æœ¬ãŒåŒã˜ãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…±æœ‰ã™ã‚‹ã®ã§ã€ã‚³ãƒ”ãƒ¼æœ¬ã‚’å¤‰æ›´ã—ãŸã‚‰åŸæœ¬ã«ã‚‚å½±éŸ¿ãŒã§ã‚‹ã®ã§ã™ã€‚

*(Javascriptã®ã‚³ãƒ”ãƒ¼ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã«ã¤ã„ã¦ã¯ä»¥å‰æ›¸ã„ãŸã€Œ[ã‚·ãƒ£ãƒ­ãƒ¼ã‚³ãƒ”ãƒ¼ãƒ»ãƒ‡ã‚£ãƒ¼ãƒ—ã‚³ãƒ”ãƒ¼ã¨ã¯](https://zenn.dev/luvmini511/articles/722cb85067d4e9)ã€ã§ã‚‚èª¬æ˜ã—ã¦ã¾ã™ã®ã§ã€ã”å‚è€ƒãã ã•ã„ã€‚)*

ã“ã®ã‚ˆã†ã«`state`ã‚’å¤‰æ›´ã™ã‚‹è¡Œç‚ºã¯å†ä»£å…¥ã ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã§ã™ã®ã§ã€ã€Œ`state`ã‚’å¤‰æ›´ã™ã‚‹ã€ã¨ã„ã†ã“ã¨ã¯**ãƒ¡ãƒ¢ãƒªã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹å€¤ã‚’å¤‰æ›´ã™ã‚‹ã™ã¹ã¦ã®è¡Œç‚º**ã¨å®šç¾©ã—ãŸã»ã†ãŒè‰¯ã„ã¨æ€ã„ã¾ã™ã€‚


## 2. immutabilityãŒå¤§äº‹ãªç†ç”±

### 2-1. äºˆæƒ³ã§ããªã„stateã®æ›´æ–°ã‚’å¡ã’ã‚‰ã‚Œã‚‹
`state`ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¾çŠ¶ã‚’ç¤ºã—ã¦ãã‚Œã‚‹ã‚‚ã®ã§ã™ã€‚ã—ã‹ã—ã€ã‚ã¡ã“ã¡ã§`state`ã‚’å‚ç…§ã—ãŸã‚Šå¤‰æ›´ã—ã¾ãã£ãŸå ´åˆã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¾çŠ¶ãŒã‚ã‹ã‚‰ãªããªã‚‹å±é™ºãŒã‚ã‚Šã¾ã™ã€‚

ã™ã”ãæ¥µç«¯çš„ãªä¾‹ã‚’ä¸Šã’ã¦ã¿ã¾ã™ã€‚
```javascript
const hi = { greeting: 'ãŠã¯ã‚ˆã†' };

// ã‚³ãƒ¼ãƒ‰ï¼‘ä¸‡è¡Œ

console.log(`${hi.greeting}, ã¿ã‚“ã¡ã‚ƒã‚“`);
```
ã“ã“ã§consoleçª“è¦‹ãŸã‚‰`ãŠã¯ã‚ˆã†, ã¿ã‚“ã¡ã‚ƒã‚“`ãŒå‡ºã‚‹ã¨æ€ã„ã¾ã™ã€‚ãŒã€èª°ã‹ã‚³ãƒ¼ãƒ‰ï¼‘ä¸‡è¡Œã®ä¸­ã§`hi`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å¤‰æ›´ã—ã¦ã—ã¾ã£ãŸã‚‰æ€¥ã«`ã•ã‚ˆãªã‚‰, ã¿ã‚“ã¡ã‚ƒã‚“`ã¨ã‹ãŒå‡ºã‚‹å¯èƒ½æ€§ã‚‚å…¨ç„¶ã‚ã‚Šã¾ã™ã€‚

ã“ã®çŠ¶æ³ã§èª°ãŒ`hi`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ›´æ–°ã—ãŸã®ã‹æ¢ã™ã“ã¨ã¯é›£ã—ã„ã§ã™ã€‚(ã—ã‹ã‚‚ãƒã‚°ã˜ã‚ƒãªã„ã‹ã‚‰ã‚¨ãƒ©ãƒ¼ã‚‚å‡ºãªã„)

immutabilityã‚’å®ˆã‚‹ã¨ã„ã†ã“ã¨ã¯**ãƒ¡ãƒ¢ãƒªã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰æ›´ã—ãªã„ã“ã¨ãªã®ã§ã€ã“ã†ã„ã†äºˆæƒ³ã§ããªã„stateã®æ›´æ–°ã‚’å¡ã’ã‚‰ã‚Œã¾ã™**ã€‚

### 2-2. stateå¤‰æ›´ãŒè¿½è·¡ã§ãã‚‹

ä¸Šã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã™ãŒã€å®Ÿã¯ã‚³ãƒ¼ãƒ‰ï¼‘ä¸‡è¡Œã®ãªã‹ã«ã“ã†ã„ã†é–¢æ•°ãŒã‚ã‚‹ã¨ã—ã¾ã™ã€‚
```javascript
const hi = { greeting: "ãŠã¯ã‚ˆã†" };

function changeName(object) {
  object.greeting = "ã•ã‚ˆãªã‚‰";
  return object;
}

const bye = changeName(hi);

console.log(`${hi.greeting}, ã¿ã‚“ã¡ã‚ƒã‚“`); // ã•ã‚ˆãªã‚‰, ã¿ã‚“ã¡ã‚ƒã‚“
console.log(`${bye.greeting}, ã¿ã‚“ã¡ã‚ƒã‚“`); // ã•ã‚ˆãªã‚‰, ã¿ã‚“ã¡ã‚ƒã‚“
```
ã“ã“ã§åŸæœ¬ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¾ã§å¤‰æ›´ã•ã‚Œã‚‹ã®ã‚‚å•é¡Œã§ã™ãŒã€ã‚‚ã†ä¸€ã¤ã®å•é¡Œã¯ã“ã†ã„ã†`state`ã®å¤‰æ›´ã‚’è¿½è·¡ã§ããªã„ã¨ã„ã†ã“ã¨ã§ã™ã€‚ã“ã®ä¾‹ã®`hi`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨`bye`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯å¤‰æ•°åãŒé•ã†ã ã‘ã§ã€å®Ÿéš›ã¯åŒã˜ãƒ¡ãƒ¢ãƒªã«ä¿å­˜ã•ã‚Œã¦ã‚‹ãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚

ã§ã™ã®ã§ã€Javascriptã¯ï¼’ã¤ã‚’åŒã˜ã‚‚ã®ã ã¨åˆ¤æ–­ã—ã¾ã™ã€‚
```javascript
console.log(hi === bye) // true
```

ã—ã‹ã—ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨é…åˆ—ãªã©ã‚’å…¨ãå¤‰æ›´ã—ãªã„ã“ã¨ã‚‚ä¸å¯èƒ½ã§ã—ã‚‡ã†ã€‚ã“ã®å•é¡Œã¯**æ–°ã—ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚„é…åˆ—ã‚’ç”Ÿæˆã™ã‚‹**ã“ã¨ã§è§£æ±ºã§ãã¾ã™ã€‚

```javascript
const hi = { greeting: "ãŠã¯ã‚ˆã†" };

function changeName(object) {
  const newObject = { ...object }; // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚³ãƒ”ãƒ¼
  newObject.greeting = "ã•ã‚ˆãªã‚‰";
  return newObject;
}

const bye = changeName(hi);

console.log(`${hi.greeting}, ã¿ã‚“ã¡ã‚ƒã‚“`); // ãŠã¯ã‚ˆã†, ã¿ã‚“ã¡ã‚ƒã‚“
console.log(`${bye.greeting}, ã¿ã‚“ã¡ã‚ƒã‚“`); // ã•ã‚ˆãªã‚‰, ã¿ã‚“ã¡ã‚ƒã‚“
```
ã“ã®ã‚ˆã†ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã‚Œã‚’ã„ã˜ã£ãŸã‚‰å¤§ä¸ˆå¤«ã§ã—ãŸã€‚ã“ã®æ›¸ãæ–¹ãŒã‚ã‚“ã©ã†ãã•ã„ãªã‚‰ä»¥ä¸‹ã®ã‚ˆã†ãªæ›¸ãæ–¹ã§ã‚‚ã„ã‘ã¾ã™ã€‚
```javascript
function changeName(object) {
  return {
    ...object,
    greeting: "ã•ã‚ˆãªã‚‰"
  };
}
```
`changeName`ãŒè¿”ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯`hi`ã¨å…¨ç„¶é•ã†ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚äºˆæƒ³ã§ããªã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å¤‰æ›´ã‚‚å¡ã’ã‚‰ã‚Œã¾ã™ã—ã€`state`ã®å¤‰æ›´ã‚‚è¿½è·¡ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
```javascript
console.log(hi === bye) // false
```

ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ›´æ–°ã•ã›ã‚‹ã¨ãã€Œæ›´æ–°ã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€ã‚’æ–°ã—ãç”Ÿæˆã™ã‚‹ã¨ã€æ›´æ–°å‰ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨æ›´æ–°å¾Œã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¯”ã¹ãŸæ™‚`false`ãŒã§ã¾ã™ã€‚ã“ã®äº‹å®Ÿã‚’åˆ©ç”¨ã—ã¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæ›´æ–°ã•ã‚ŒãŸã¨ã‚ã‹ã‚Šã¾ã™ã€‚

ã“ã‚ŒãŒ**ReactãŒimmutabilityã‚’å¤§äº‹ã«ã™ã‚‹ç†ç”±**ã§ã™ã€‚Reactã¯`state`ã®å¤‰æ›´ã‚’æ¢çŸ¥ã—ã€å¤‰æ›´å‰ã¨å¤‰æ›´å¾Œã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¯”è¼ƒã—ã¦é•ã†ã¨åˆ¤æ–­ã—ãŸã‚‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¾ã™ã€‚ã“ã®**æ¯”è¼ƒã™ã‚‹ã¨ãã«ãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ãŒé•ã£ã¦ãŸã‚‰`false`ãŒå‡ºã‚‹ã®ã§ã™ãåˆ¤æ–­ã§ãã¾ã™**ã€‚

ã‚‚ã—immutabilityã‚’å®ˆã‚‰ãªã‹ã£ãŸãªã‚‰ã™ã¹ã¦ã®è¦ç´ ã‚’ä¸€ã¤ä¸€ã¤æ¯”è¼ƒã™ã‚‹ã“ã¨ã«ãªã‚‹ã®ã§ã€ã‚‚ã£ã¨ã‚³ã‚¹ãƒˆãŒã‹ã‹ã‚‹ã§ã—ã‚‡ã†ã€‚


## 3. immutabilityã¯ã‚ã‚“ã©ã†ãã•ã„

ã—ã‹ã—æ®‹å¿µãªãŒã‚‰immutabilityã‚’å®ˆã‚‹ã“ã¨ã¯ã‚ã‚“ã©ã†ãã•ã„ã§ã™ã€‚

ã“ã‚Œã¯ç§ãŒå‹‰å¼·ã§æ›¸ã„ã¦ãŸã‚³ãƒ¼ãƒ‰ã§ã™ã€‚SNSã‚’å®Ÿè£…ã—ã¦ã¦ã€ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ã™ã‚‹æ©Ÿèƒ½ã‚’reduxã®reducerã«æ›¸ã„ã¦ã¾ã—ãŸã€‚
```javascript
const reducer = (state, action) => {
  switch (action.type) {
    // è‰²ã€…ã‚ã‚‹
    case ADD_COMMENT_SUCCESS: {
      const postIndex = state.mainPosts.findIndex((mainPost) => mainPost.id === action.data.postId);
      const commentAddedPost = { ...state.mainPosts[postIndex] };
      commentAddedPost.Comments = [generateComment(action.data.content), ...mainPost.Comments];
      const mainPosts = [...state.mainPosts];
      mainPosts[postIndex] = commentAddedPost;
      return {
        ...state,
        mainPosts,
        addCommentLoading: false,
        addCommentDone: true
      };
    }
    // è‰²ã€…ã‚ã‚‹
    default:
      return state;
  }
};
```
é…åˆ—ã¨ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãšã£ã¨ã‚³ãƒ”ãƒ¼ã—ã¦ã‚‹ã‹ã‚‰`...`ã‚‚å¤šã„ã—ã€é•·ã„ã—ã€èª­ã¿ã¥ã‚‰ã„ã—ã¨ã‚Šã‚ãˆãšã‚ã‚“ã©ã†ãã•ã„ã§ã™ã€‚ã“ã‚Œæ›¸ã„ã¦ãƒã‚¸ã‹ã¨æ€ã„ã¾ã—ãŸã€‚

ã§ã™ã®ã§ã€immerã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

## 4. Immer

### 4-1. Immerã¨ã¯

immerã¯**immutabilityã‚’å®ˆã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ¥½ã«æ›¸ã‘ã‚‹ã‚ˆã†ã«ã—ã¦ãã‚Œã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**ã§ã™ã€‚

ä½¿ã„æ–¹ã¯[å…¬å¼ã‚µã‚¤ãƒˆ](https://immerjs.github.io/immer/docs/introduction#quick-example)ã®Quick Exampleã‚’è¦‹ã‚‹ã¨ã™ãã‚ã‹ã‚Šã¾ã™ã€‚
```javascript
import produce from "immer"

const baseState = [
    {
        todo: "Learn typescript",
        done: true
    },
    {
        todo: "Try immer",
        done: false
    }
]

const nextState = produce(baseState, draftState => {
    draftState.push({todo: "Tweet about it"})
    draftState[1].done = true
})
```
immerãŒæä¾›ã™ã‚‹`produce`é–¢æ•°ã•ãˆä½¿ãˆã°ç°¡å˜ã«immutabilityã‚’å®ˆã‚Œã¾ã™ã€‚
`produce`é–¢æ•°ã¯2ã¤ã®å¼•æ•°ãŒå¿…è¦ã§ã€**ç¬¬1å¼•æ•°ã¯æ›´æ–°ã—ãŸã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚‚ã—ãã¯é…åˆ—ã€ç¬¬2å¼•æ•°ã¯ç¬¬1å¼•æ•°ã‚’ã©ã†æ›´æ–°ã™ã‚‹ã‹ã‚’å®šç¾©ã™ã‚‹é–¢æ•°**ã§ã™ã€‚

### 4-2. Immerã‚’ä½¿ã†ã¨

3ã®ä¾‹ã‚’immerã‚’ä½¿ã£ã¦ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã™ã‚‹ã¨ã“ã†ãªã‚Šã¾ã™ã€‚
```javascript
const reducer = (state, action) =>
  produce(state, (draft) => {
    switch (action.type) {
      // è‰²ã€…ã‚ã‚‹
      case ADD_COMMENT_SUCCESS: {
        const commentAddedPost = draft.mainPosts.find((mainPost) => mainPost.id === action.data.postId);
        commentAddedPost.Comments.unshift(generateComment(action.data.content));
        draft.addCommentLoading = false;
        draft.addCommentDone = true;
        break;
      }
      // è‰²ã€…ã‚ã‚‹
      default:
        break;
    }
  });
```
`produce`ã®ç¬¬2å¼•æ•°ã§ã‚ã‚‹é–¢æ•°ã®ä¸­ã«ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ›¸ãã¾ã™ã€‚æ›¸ãæ™‚ã€immutabilityãªã‚“ã¦æ€ã„ã£ãã‚Šç ´å£Šã™ã‚Œã°ã‚ˆã„ã§ã™ã€‚ãã†ã—ãŸã‚‰**immerãŒå‹æ‰‹ã«ãã®ã‚³ãƒ¼ãƒ‰ã‚’immutabilityã‚’å®ˆã‚‹ã‚³ãƒ¼ãƒ‰ã«å¤‰ãˆã¦ãã‚Œã‚‹ã®ã§ã€ã‚ã¡ã‚ƒãã¡ã‚ƒä¾¿åˆ©**ã§ã™ã€‚ã¡ã‚‡ã£ã¨æ„Ÿå‹•ã—ã¾ã—ãŸã€‚


---

## çµ‚ã‚ã‚Š

èª¿ã¹ãŸã‚‰å‰ã¯immutable.jsã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒã‚ˆãä½¿ã‚ã‚Œã¦ãŸã‚ˆã†ã§ã™ãŒã€[npmtrends](https://www.npmtrends.com/immer-vs-immutable)ã§ç¢ºèªã—ãŸã‚‰æœ€è¿‘ã¯immerãŒå‹ã£ã¦ã¾ã—ãŸã€‚immerã®ã»ã†ãŒä½¿ã„ã‚„ã™ã„ã‹ã‚‰ã ã¨æ€ã„ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/0wrflxaxvhcjt6bm1gfy56dog7g0)