---
title: "lint-staged + husky ã§ã‚³ãƒŸãƒƒãƒˆã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ cspell ã‚’èµ°ã‚‰ã›ã‚‹"
emoji: "ğŸ¦‘"
type: "tech"
topics:
  - "javascript"
  - "eslint"
  - "frontend"
  - "husky"
  - "cspell"
published: true
published_at: "2022-06-21 21:47"
---

# ğŸŒ¼ ã¯ã˜ã‚ã«

ã‚µã‚¤ãƒ‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è«¸ã€…ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­ã€ cspellã‚’æŠ•å…¥ã—ã¦ã‚¿ã‚¤ãƒã‚’æ¤œæŸ»ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸï¼ˆã‚¿ã‚¤ãƒé­”ç‹ãªã®ã§ï¼‰

https://cspell.org/

scpellã®åŸºæœ¬çš„ãªä½¿ã„æ–¹ã¯`cspell "**"`ã‚„`cspell "src/**/*.js"`ãªã©ã‚³ãƒãƒ³ãƒ‰ã«ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã™â€¦ãŒã€ã“ã‚Œã ã¨ç¯„å›²ãŒåºƒã™ãã¾ã™ã€‚

æ¯å›ãŸãã•ã‚“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¿ã‚¤ãƒæ¤œæŸ»ã™ã‚‹ã®ã¯ç„¡é§„ãªã®ã§ã€**lint-staged ã¨ husky ã‚’ä½¿ã£ã¦ã‚³ãƒŸãƒƒãƒˆã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ã‚¿ã‚¤ãƒæ¤œæŸ»ã§ãã‚‹è¨­å®šæ–¹æ³•**ã‚’ç´¹ä»‹ã—ã¾ã™ï¼


# 1. lint-staged

https://github.com/okonet/lint-staged

lint-staged ã¯ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰å…¨ä½“ã§ã¯ãªã **git stage ã•ã‚Œã¦ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ linter ã‚’èµ°ã‚‰ã›ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼**ã§ã™ã€‚

README.mdã«ãªãœã“ã†ã„ã†ã‚‚ã®ã‚’ä½œã£ãŸã‹ã‚‚èª¬æ˜ã—ã¦ãã‚Œã¦ã¾ã™ã€‚

> Linting makes more sense when run before committing your code. By doing so you can ensure no errors go into the repository and enforce code style. But **running a lint process on a whole project is slow, and linting results can be irrelevant. Ultimately you only want to lint files that will be committed.**

ç§ã¨ã‚„ã‚ŠãŸã„ã“ã¨ã®æ–¹å‘æ€§ãŒä¸€è‡´ã—ã¦ã¾ã™ã­ã€‚

ã¤ã¾ã‚Š lint-staged ãŒã‚³ãƒŸãƒƒãƒˆã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ linter ã‚’ã‹ã‘ã‚‹ã“ã¨ã‚’åˆ©ç”¨ã—ãŸã‚‰ã€**ã‚³ãƒŸãƒƒãƒˆã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ cspell ã‚’èµ°ã‚‰ã›ã‚‹ã“ã¨ã‚‚å¯èƒ½**ã¨ã„ã†ã“ã¨ã§ã™ã€‚

# 2. husky

ä»Šå› git hook ã¯ husky ã‚’ä½¿ã„ã¾ã™ã€‚ä»–ã® git hook ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ã‚’ä½¿ã£ã¦ã‚‚ã§ãã‚‹ã¯ãšã§ã™ãŒã€ã“ã®è¨˜äº‹ã§ã¯ husky ã‚’ä½¿ã£ãŸè¨­å®šæ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

https://github.com/typicode/husky


# 3. è¨­å®šæ–¹æ³•

## 3-1. ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

cspellã€lint-stagedã€huskyã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚

```shell
yarn add --dev cspell lint-staged husky
```

+) husky ã® init ã‚‚ã—ã¦ãŠãã¾ã™
```shell
yarn husky-init
```

## 3-2. `.lintstagedrc.js`ä½œæˆ

ã¾ãš lint-staged ã®è¨­å®šã‚’ã—ã¾ã™ã€‚æ–¹æ³•ã¯è‰²ã€…ã‚ã‚Šã¾ã™ãŒã€ä»Šå›ã¯[ JavaScript ã§è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹æ–¹æ³•](https://github.com/okonet/lint-staged#using-js-configuration-files)ã‚’ä½¿ã„ã¾ã™ã€‚ä¾¿åˆ©ãªã“ã¨ã«å…¬å¼ãŒãŸãã•ã‚“ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’æº–å‚™ã—ã¦ãã‚Œã¦ã‚‹ã®ã§ã€ãã‚Œã‚’ä½¿ã£ã¦æ¥½ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆã«`.lintstagedrc.js`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

ãã—ã¦å…¬å¼ãŒæº–å‚™ã—ã¦ãã‚Œã¦ã‚‹ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã®ä¸€ã¤ã§ã‚ã‚‹[ã€ŒUse relative paths for commandsã€](https://github.com/okonet/lint-staged#example-use-relative-paths-for-commands)ã‚’ä¸€æ—¦ã‚³ãƒ”ãƒšã—ã¾ã™ã€‚

```js:.lintstagedrc.js
import path from 'path'

export default {
  '*.ts': (absolutePaths) => {
    const cwd = process.cwd()
    const relativePaths = absolutePaths.map((file) => path.relative(cwd, file))
    return `ng lint myProjectName --files ${relativePaths.join(' ')}`
  },
}
```
ã“ã®ã‚³ãƒ¼ãƒ‰ã¯ã€Œã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚Œã¦ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­ã§ã‚‚`.ts`æ‹¡å¼µå­ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦é–¢æ•°ã®æ–¹ã§ãƒªã‚¿ãƒ¼ãƒ³ã—ã¦ã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã€æ„å‘³ã ã¨æ€ã‚ã‚Œã¾ã™ã€‚ãã®ã‚³ãƒãƒ³ãƒ‰ã§ä½¿ã†ãŸã‚ã®ç›¸å¯¾ãƒ‘ã‚¹ã‚‚è¨ˆç®—ã—ã¦ã„ã¾ã™ã­ã€‚
(*ã“ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã¯å¼•æ•°ã‚’`absolutePaths`ã¨è¡¨ç¾ã—ã¦ã¾ã™ãŒã€ä»–ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’è¦‹ã¦ã¿ã‚‹ã¨æ­£ç¢ºã«ã¯ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚Œã¦ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãŸã¡ã®åå‰ã®é…åˆ—ã®ã‚ˆã†ã§ã™*)

ã¨ã‚Šã‚ãˆãš**ç›¸å¯¾ãƒ‘ã‚¹ã®è¨ˆç®—ãŒæ—¢ã«ã‚ã‚‹ã®ã§ã€ã“ã‚Œã‚’ä½¿ã£ã¦ cspell ã‚³ãƒãƒ³ãƒ‰ã‚’æ›¸ãã¾ã™**ã€‚

```js
const path = require("path");

module.exports = {
  // å¯¾è±¡æ‹¡å¼µå­ã‚’ã‚«ã‚¹ã‚¿ãƒ 
  "*.{js,ts,tsx}": (absolutePaths) => { 
    const cwd = process.cwd();
    const relativePaths = absolutePaths.map((file) => path.relative(cwd, file)).join(" "); // join ã¾ã§ã“ã“ã§ã‚„ã£ã¡ã‚ƒã†
    return `cspell ${relativePaths}`; // ã‚³ãƒãƒ³ãƒ‰ä¿®æ­£
  },
};
```

æ¤œæŸ»ã—ãŸã„æ‹¡å¼µå­ã‚’è‡ªåˆ†ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«åˆã‚ã›ã¦ã€ã‚³ãƒãƒ³ãƒ‰ã‚‚ cspell ã«ä¿®æ­£ã—ã¾ã—ãŸã€‚ã‹ã‚“ãŸã‚“ï¼

+) ã¡ãªã¿ã«`import`ã¨`export default`ã‚’ä½¿ã£ãŸã‚‰ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸã®ã§`require`ã¨`module.exports`ã«ä¿®æ­£ã—ã¾ã—ãŸ
- `SyntaxError: Cannot use import statement outside a module`
- `SyntaxError: Unexpected token 'export'`

cspell ã‚³ãƒãƒ³ãƒ‰ã ã‘å®Ÿè¡Œã—ãŸã„ã®ãªã‚‰ã“ã“ã¾ã§ã§ã‚‚ååˆ†ã§ã™ã€‚

ãŒã€å®Ÿã¯[è¤‡æ•°ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚‚å¯èƒ½](https://github.com/okonet/lint-staged#running-multiple-commands-in-a-sequence)ã§ã™ã€‚è¤‡æ•°ã®å ´åˆã¯ã‚³ãƒãƒ³ãƒ‰ã®é…åˆ—ã‚’ãƒªã‚¿ãƒ¼ãƒ³ã—ã¾ã™ã€‚

```js
const path = require("path");

module.exports = {
  "*.{js,ts,tsx}": (absolutePaths) => {
    const cwd = process.cwd();
    const relativePaths = absolutePaths.map((file) => path.relative(cwd, file)).join(" ");
    return [
      `eslint ${relativePaths}`,
      `prettier --write ${relativePaths}`,
      `cspell ${relativePaths}`,
    ];
  },
};
```

eslint ã¨ prettier ã®ã‚³ãƒãƒ³ãƒ‰ã‚‚è¿½åŠ ã—ã¦ã¿ã¾ã—ãŸã€‚å‹•ãçš„ã«ã¯æœ€åˆã®ã‚³ãƒãƒ³ãƒ‰ãŒå…¨éƒ¨æˆåŠŸã—ãŸã‚‰æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ï¼ˆé€”ä¸­ã§ã‚³ã‚±ãŸã‚‰ãã®å¾Œã®ã‚³ãƒãƒ³ãƒ‰ã¯å®Ÿè¡Œã•ã‚Œãšã‚³ãƒŸãƒƒãƒˆãŒä¸­æ–­ã•ã‚Œã‚‹ï¼‰

ã“ã‚Œã§ lint-staged è¨­å®šãŒçµ‚ã‚ã‚Šã¾ã—ãŸã€‚


## 3-3. pre-commit è¨­å®š

è¨­å®šã—ãŸ lint-staged ã‚’ã‚³ãƒŸãƒƒãƒˆã®å‰ã«èµ°ã‚‰ã›ãŸã„ã®ã§`.husky/pre-commit`ã«`yarn lint-staged`ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```shell:pre-commit
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

yarn lint-staged
```

`.husky/pre-commit`ã«é¦´æŸ“ã¿ãŒãªã„æ–¹ã¯ç§ãŒä»¥å‰æ›¸ã„ãŸ husky è¨˜äº‹ã‚’ã”å‚è€ƒã«ã©ã†ã
https://zenn.dev/luvmini511/articles/a47b1aa0310d1a

# 4. çµæœ

è¨­å®šãŒçµ‚ã‚ã£ãŸã®ã§ã€ã¡ã‚ƒã‚“ã¨å‹•ãã®ã‹ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚
æ¤œè¨¼ã®ãŸã‚ã€ã‚ã–ã¨`pages/about.tsx`ãƒ•ã‚¡ã‚¤ãƒ«ã«`Hoem`ã¨ã„ã†ã‚¿ã‚¤ãƒã‚’æ··ãœã¦ãŠãã¾ã—ãŸã€‚

ãã‚Œã§ã¯`git add pages/about.tsx`ã—ãŸå¾Œã€ã‚³ãƒŸãƒƒãƒˆã—ã¦ã¿ã¾ã™ã€‚

```shell
yarn run v1.22.18
$ lint-staged
âœ” Preparing lint-staged...
â¯ Running tasks for staged files...
  â¯ .lintstagedrc.js â€” 1 file
    â¯ *.{js,ts,tsx} â€” 1 file
      âœ” eslint pages/about.tsx
      âœ” prettier --write pages/about.tsx
      âœ– cspell pages/about.tsx [FAILED]
â†“ Skipped because of errors from tasks. [SKIPPED]
âœ” Reverting to original state because of errors...
âœ” Cleaning up temporary files...

âœ– cspell pages/about.tsx:
1/1 ./pages/about.tsx 768.94ms X
CSpell: Files checked: 1, Issues found: 1 in 1 files
/Users/<ãƒ¦ãƒ¼ã‚¶ãƒ¼å>/<ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå>/pages/about.tsx:9:12 - Unknown word (Hoem) # ã‚¿ã‚¤ãƒç™ºè¦‹
error Command failed with exit code 1.
info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.
husky - pre-commit hook exited with code 1 (error)
```

**ï½·ï¾€â€•â€•(ï¾Ÿâˆ€ï¾Ÿ)â€•â€•!!**

ï¼“ã¤ã®ã‚³ãƒãƒ³ãƒ‰å…¨éƒ¨ã‚³ãƒŸãƒƒãƒˆã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚ã‚‹`pages/about.tsx`ã ã‘è¦‹ã¦ã‚‹ã‹ã¤ã€ã‚¿ã‚¤ãƒãŒæ¤œçŸ¥ã•ã‚Œç„¡äº‹ã‚³ãƒŸãƒƒãƒˆãŒå¤±æ•—ã—ã¾ã—ãŸğŸ‘ğŸ‘ğŸ‘

ã“ã‚Œã§ä½™è¨ˆãªãƒ•ã‚¡ã‚¤ãƒ«ã¾ã§ã‚³ãƒãƒ³ãƒ‰èµ°ã‚‰ã›ãªãã¦æ¸ˆã¿ã¾ã—ãŸã€ã‚„ã£ãŸï¼

# ğŸŒ· çµ‚ã‚ã‚Š

ã“ã‚Œè¨­å®šã—ãªã„ã¨å¤§ãã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãªã‚‰æ¯å›æ•°ç™¾ãƒ»æ•°åƒãƒ•ã‚¡ã‚¤ãƒ«æ¤œæŸ»ã™ã‚‹ã“ã¨ã«ãªã‚‹ã®ã§ãœã²ã“ã®æ–¹æ³•ä½¿ã£ã¦ã¿ã¦ãã ã•ã„


