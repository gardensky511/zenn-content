---
title: "ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã§ã¯ 0.1+0.2 ãŒ 0.3 ã§ã¯ãªã„ç†ç”±"
emoji: "ğŸ’­"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["tech", "zennfes2025free"]
published: true
---

## ğŸŒ¼ ã¯ã˜ã‚ã«

ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã§ã¯ $0.1 + 0.2$ ãŒ $0.3$ ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

```js:JavaScript
0.1 + 0.2 === 0.3 // false
```

JavaScript ã ã‘ã§ã¯ãªãã€ã»ã¨ã‚“ã©ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã¯åŒã˜ã‚ˆã†ãªçµæœã‚’å‡ºåŠ›ã—ã¾ã™ã€‚

ä»Šå›ã¯ãã®ç†ç”±ã‚’è§£èª¬ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚


## ãƒ¡ãƒ¢ãƒªãŒæ•°å­—ã‚’ä¿å­˜ã™ã‚‹æ–¹æ³•

ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ãŒãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã™ã‚‹ã¨ãè«¸ã€…ãƒ‡ãƒ¼ã‚¿ã¯ãƒ¡ãƒ¢ãƒªã«ä¿å­˜ã•ã‚Œã‚‹ã®ã§ã€æ•°å­—ã‚‚ãƒ¡ãƒ¢ãƒªã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚

ã§ã™ãŒã€ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã®ä¸–ç•Œè¦³ã§ã¯$0$ã¨$1$ã—ã‹èªè­˜ã§ããªã„ã®ã§ã€10é€²æ•°ã®æ•°å­—ã¯2é€²æ•°ã«å¤‰æ›ã•ã‚Œã¦ã‹ã‚‰ä¿å­˜ã•ã‚Œã¾ã™ã€‚ä¾‹ãˆã°ã€$7$ã¯2é€²æ•°ã«å¤‰æ›ã—ãŸã‚‰$111$ãªã®ã§$111$ãŒãƒ¡ãƒ¢ãƒªã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚


## å°æ•°ã¯ã©ã†ä¿å­˜ã•ã‚Œã‚‹ã®ã‹

ã§ã¯$5.75$ã®ã‚ˆã†ãªå°æ•°ã¯ã©ã†ã§ã—ã‚‡ã†ã‹ã€‚

ã»ã¨ã‚“ã©ã®å ´åˆã¯å°æ•°ã‚’ä¿å­˜ã™ã‚‹ã¨ã IEEE^[IEEE(Institute of Electrical and Electronics Engineers): é›»æ°—ãƒ»é›»å­ãƒ»æƒ…å ±åˆ†é‡ã®å›½éš›çš„ãªå­¦ä¼šï¼æ¨™æº–åŒ–å›£ä½“] ã¨ã„ã†å›£ä½“ãŒæ±ºã‚ãŸæ¨™æº–ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ï¼ˆ[IEEE 754](https://ja.wikipedia.org/wiki/IEEE_754)ï¼‰ã€‚ã“ã®æ–¹å¼ã§ã¯å°æ•°ã‚’$1.xxxx \times 2^{e}$ã®å½¢ã«æ­£è¦åŒ–ã—ã¦ã€ãã‚Œã‚’**ç¬¦å·éƒ¨ãƒ»æŒ‡æ•°éƒ¨ãƒ»ä»®æ•°éƒ¨ã®3ã¤ã®éƒ¨åˆ†ã«åˆ†ã‘ã¦ä¿å­˜**ã—ã¾ã™ã€‚

å®Ÿéš›ã‚„ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚$5.75$ã¯2é€²æ•°ã«å¤‰æ›ã™ã‚‹ã¨$101.11$ã«ãªã‚‹ã®ã§ã€ã“ã‚Œã‚’æ­£è¦åŒ–ã—ã¾ã™ã€‚

$1.xxxx \times 2^{e}$ã®å½¢ã«æ­£è¦åŒ–ã™ã‚‹æµã‚Œã¯ã–ã£ãã‚Šã“ã†ã§ã™ã€‚

1. å°æ•°ç‚¹ã‚ˆã‚Šå·¦ãŒ $1$ ã«ãªã‚‹ã‚ˆã†ã«å°æ•°ç‚¹ã‚’å·¦ã‚‚ã—ãã¯å³ã«ç§»å‹•
2. å°æ•°ç‚¹ã‚’ç§»å‹•ã—ãŸæ•°å­—ã«$2^{e}$ã‚’æ›ã‘ã‚‹
   - å·¦ã«$n$ãƒã‚¹ç§»å‹•ã—ãŸå ´åˆã¯ $e = +n$
   - å³ã«$n$ãƒã‚¹ç§»å‹•ã—ãŸå ´åˆã¯ $e = -n$

$101.11$ã®å ´åˆã€å°æ•°ç‚¹ã‚ˆã‚Šå·¦ã‚’$1$ã«ã™ã‚‹ãŸã‚ã«å°æ•°ç‚¹ã‚’å·¦ã«2ãƒã‚¹ç§»å‹•ã•ã›ã¾ã™ï¼ˆ$1.0111$ï¼‰ã€‚å°æ•°ç‚¹ã‚’**å·¦ã«2ãƒã‚¹**ç§»å‹•ã—ãŸã®ã§ã€$2^{2}$ã‚’æ›ã‘ã¾ã™ï¼ˆ$1.0111 \times 2^{2}$ï¼‰

![](https://storage.googleapis.com/zenn-user-upload/60143dfe493b-20251015.png)
*æ­£è¦åŒ–ã®ä¾‹*


ã“ã‚Œã§æ­£è¦åŒ–ã§ããŸã®ã§ã€å®Ÿéš›ã©ã†ä¿å­˜ã•ã‚Œã‚‹ã‹ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚32ãƒ“ãƒƒãƒˆã«ä¿å­˜ã™ã‚‹å ´åˆã‚’åŸºæº–ã¨ã—ã¦è©±ã™ã®ã§ã€ã¾ãšã¯32ãƒ“ãƒƒãƒˆã®ãƒ¡ãƒ¢ãƒªç©ºé–“ã‚’ç¢ºä¿ã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/d71f69d987de-20251014.png)


1ç•ªæœ€åˆã®1ãƒ“ãƒƒãƒˆã¯**ç¬¦å·éƒ¨**ã§ã™ã€‚ã“ã“ã«ã¯ä¿å­˜ã™ã‚‹æ•°å­—ãŒæ­£ã®æ•°ã ã£ãŸã‚‰ $0$ ã‚’ã€è² ã®æ•°ã ã£ãŸã‚‰ $1$ ã‚’å…¥ã‚Œã¾ã™ã€‚$1.0111 \times 2^{2}$ ã¯æ­£ã®æ•°ãªã®ã§ $0$ ãŒå…¥ã‚Šã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/16a27d9a82a7-20251014.png)
*ç¬¦å·éƒ¨*

ãã®æ¬¡ã®8ãƒ“ãƒƒãƒˆã¯**æŒ‡æ•°éƒ¨**ã§ã™ã€‚ã“ã“ã«ã¯$1.xxxx \times 2^{e}$ã®$e$ã‚’ä¿å­˜ã—ã¾ã™ã€‚ãŸã ãã‚Œã‚’ã™ãä¿å­˜ã™ã‚‹ã®ã§ã¯ãªãã€ä»¥ä¸‹ã®æ‰‹é †ã§å¤‰æ›ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚

1. æŒ‡æ•°$e$ã«$127$ã‚’è¶³ã™
2. ãã‚Œã‚’2é€²æ•°ã«å¤‰æ›ã™ã‚‹

:::details ğŸ™‹â€â™€ï¸ãªã‚“ã§127ã‚’è¶³ã™ã‚“ã§ã™ã‹ï¼Ÿ
æŒ‡æ•°ã¯æ­£ã®æ•°ã«ãªã‚‹ã“ã¨ã‚‚(ex. $1.0111 \times 2^{2}$)ã€è² ã®æ•°ã«ãªã‚‹ã“ã¨ã‚‚(ex. $1.01 \times 2^{-3}$)ã‚ã‚Šã¾ã™ã€‚æŒ‡æ•°éƒ¨ã§ã¯æŒ‡æ•°ã‚’**ç¬¦å·ãƒ“ãƒƒãƒˆãªã—ã®8ãƒ“ãƒƒãƒˆã«ä¿å­˜ã™ã‚‹ãŸã‚**ã«$127$(ãƒã‚¤ã‚¢ã‚¹)ã‚’è¶³ã—ã¦ã€0ã€œ255 ã®ç¯„å›²ã«ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ã¾ã™ã€‚
:::

$1.0111 \times 2^{2}$ã®å ´åˆ$e$ã¯$2$ãªã®ã§ã€ãã‚Œã«$127$ã‚’è¶³ã—ãŸã‚‰$129$ã«ãªã‚Šã€$129$ã‚’2é€²æ•°ã«å¤‰æ›ã™ã‚‹ã¨$10000001$ã«ãªã‚Šã¾ã™ã€‚

ãã®$10000001$ãŒæŒ‡æ•°éƒ¨ã«å…¥ã‚Šã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/d48aa6d45b62-20251014.png)
*æŒ‡æ•°éƒ¨*

æ®‹ã‚Š23ãƒ“ãƒƒãƒˆã¯**ä»®æ•°éƒ¨**ã§ã™ã€‚$1.0111 \times 2^{2}$ã§å°æ•°ç‚¹ã‚ˆã‚Šå³ã®$0111$ã‚’å…¥ã‚Œã¾ã™ã€‚ï¼ˆä½™ã£ãŸç©ºé–“ã«ã¯$0$ãŒå…¥ã‚‹ï¼‰


![](https://storage.googleapis.com/zenn-user-upload/dcab7759b1c0-20251014.png)
*ä»®æ•°éƒ¨*

ã“ã®ã‚ˆã†ã«å®Ÿæ•°ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã™ã‚‹æ–¹æ³•ã‚’**æµ®å‹•å°æ•°ç‚¹**ï¼ˆfloating pointï¼‰ã¨è¨€ã„ã¾ã™ã€‚å°æ•°ç‚¹ãŒå›ºå®šã§ã¯ãªãã¦æµ®ã„ã¦ã‚‹ï¼ˆç§»å‹•ã—ã¦ã‚‹ï¼‰ã‹ã‚‰æµ®å‹•ã¨è¨€ã£ã¦ã‚‹ã‚“ã§ã™ã‹ã­~~çŸ¥ã‚‰ã‚“ã‘ã©~~

## 0.1+0.2â‰ 0.3 ã«ãªã‚‹ç†ç”±

ã§ã‚‚æµ®å‹•å°æ•°ç‚¹æ–¹å¼ã§ã¯æ­£ç¢ºãªå€¤ã‚’ä¿å­˜ã§ããªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

ä¾‹ãˆã°10é€²æ•°$0.1$ã®å ´åˆã€2é€²æ•°ã«å¤‰æ›ã™ã‚‹ã¨$0.0001100110011001100110011â€¦$ã®ã‚ˆã†ã«ç„¡é™å°æ•°ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã‚’æ­£è¦åŒ–ã—ãŸã‚‰$1.1001100110011001100110011â€¦ \times 2^{-4}$ã«ãªã‚Šã€ä»®æ•°éƒ¨ãŒæº¢ã‚Œå‡ºã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/4b870b9c40cd-20251015.png)
*23ãƒ“ãƒƒãƒˆ(ä»®æ•°éƒ¨)ã«åã¾ã‚‰ãªã„*

ä¿å­˜å®¹é‡ã«ã¯é™ç•ŒãŒã‚ã‚‹ã—ç„¡é™ã«æº¢ã‚Œã¦ã‚‹æ•°å­—ã‚’å…¨éƒ¨ä¿å­˜ã™ã‚‹ã‚ã‘ã«ã¯ã„ã‹ãªã„ã®ã§ã€23ãƒ“ãƒƒãƒˆã®æœ€å¾Œã®ãƒ“ãƒƒãƒˆã§1ã«åˆ‡ã‚Šä¸Šã’ã‚‹ã‹ã€0ã«åˆ‡ã‚Šæ¨ã¦ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚^[ã„ã¤åˆ‡ã‚Šä¸Šã’ã‚‹ã‹ã€ã‚‚ã—ãã¯åˆ‡ã‚Šæ¨ã¦ã‚‹ã‹ã®åŸºæº–ã¯IEEE 754æ¨™æº–ã§æ±ºã¾ã£ã¦ã‚‹]

![](https://storage.googleapis.com/zenn-user-upload/24aed294a962-20251017.png)

ã“ã®**åˆ‡ã‚Šä¸Šã’ãƒ»åˆ‡ã‚Šæ¨ã¦ãŒåŸå› ã§èª¤å·®ãŒç™ºç”Ÿ**ã—ã¾ã™ã€‚$0.1$ã‚’ä¿å­˜ã—ã¦ã‚‚ã€ä»®æ•°éƒ¨ãŒé€”ä¸­ã§åˆ‡ã‚Šä¸Šã’ã‚‰ã‚Œã‚‹ã®ã§$0.1$ãã®ã‚‚ã®ã§ã¯ãªã$0.1$ã«è¿‘ã„ä½•ã‹ã®æ•°å­—ãŒä¿å­˜ã•ã‚Œã¾ã™ã€‚

ãªã®ã§ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã§$0.1 + 0.2$ã‚’è¨ˆç®—ã•ã›ã‚‹ã¨ã€å®Ÿéš›ã¯$0.1$ã«è¿‘ã„ä½•ã‹ã®æ•°å­—ã¨$0.2$ã‚’è¶³ã—ã¦ã„ã‚‹ã®ã§ã€ãƒ”ãƒƒã‚¿ãƒªã®$0.3$ã¨ã¯é•ã†ã¨ã„ã†ã®ãŒçœŸç›¸ã§ã™ã€‚

ãµã¨æ°—ã«ãªã£ã¦ JavaScript ã§$0.1 + 0.2$ã‚’å‡ºåŠ›ã•ã›ã¦ã¿ãŸã‚‰$0.30000000000000004$ã«ãªã£ã¦ã¾ã—ãŸã€‚

```js
0.1 + 0.2 // 0.30000000000000004
```
## å°æ•°ã‚’æ‰±ã†æ™‚ã¯è¦æ³¨æ„

æ­£ç¢ºãªæ•°å€¤ã‚’æ‰±ã‚ãªã„ã¨ã„ã‘ãªã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å ´åˆã€æµ®å‹•å°æ•°ç‚¹ã®èª¤å·®ã‚’ã¡ã‚ƒã‚“ã¨è€ƒæ…®ã—ãªã„ã¨ãã®èª¤å·®ãŒåŸå› ã§äº‹æ•…ãŒèµ·ãã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚^[æ¹¾å²¸æˆ¦äº‰æ™‚$0.1$ã®èª¤å·®ãŒç´¯ç©ã•ã‚ŒãƒŸã‚µã‚¤ãƒ«ã®é˜²å¾¡ãŒå¤±æ•—ã—ã€28äººãŒæ­»äº¡ã€‚[ãƒ‘ãƒˆãƒªã‚ªãƒƒãƒˆãƒŸã‚µã‚¤ãƒ« wikipedia](https://ja.wikipedia.org/wiki/%E3%83%91%E3%83%88%E3%83%AA%E3%82%AA%E3%83%83%E3%83%88%E3%83%9F%E3%82%B5%E3%82%A4%E3%83%AB) ã®ã€Œãƒ€ãƒ¼ãƒ©ãƒ³ã§ã®å¤±æ•—ã€é …ç›®å‚ç…§]

ã§ã‚‚æµ®å‹•å°æ•°ç‚¹ã‚’ç†è§£ã—ã¦ã„ãŸã‚‰ã€æ­£ç¢ºãªæ•°å­—ã‚’æ‰±ã‚ãªã„ã¨ã„ã‘ãªã„å ´é¢ãŒæ¥ã¦ã‚‚è‰²ã€…å·¥å¤«ã§ãã‚‹ã§ã—ã‚‡ã†ã€‚

ä¾‹ãˆã°ãŠé‡‘ã®å ´åˆã€**æ•´æ•°ã«å¤‰æ›ã™ã‚‹**ã“ã¨ã§æ­£ç¢ºãªå€¤ãŒä¿å­˜ã§ãã¾ã™ã€‚$12.99$ãƒ‰ãƒ«ã¯100ã‚’æ›ã‘ã¦$1299$ã‚»ãƒ³ãƒˆã«å¤‰æ›ã—ãŸã‚‰å°æ•°ã§ã¯ãªãæ•´æ•°ã«ãªã‚‹ã®ã§èª¤å·®ãŒç™ºç”Ÿã—ãªããªã‚Šã¾ã™ã€‚

ã¾ãŸã€æ•°å­—ã®æ¯”è¼ƒã®ã¨ãã¯ `0.1 + 0.2 === 0.3` ã®ã‚ˆã†ã«ç›´æ¥æ¯”è¼ƒã™ã‚‹ã®ã§ã¯ãªãã€**èª¤å·®ã‚’æ¯”è¼ƒã™ã‚‹**æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚

ä¾‹ãˆã°$0.1 + 0.2$ã¨$0.3$ã‚’æ¯”è¼ƒã™ã‚‹å ´åˆã€ï¼’ã¤ã®æ•°å­—ã®å·®ãŒè¨±å®¹ã§ãã‚‹ã»ã©å°ã•ã„ãªã‚‰åŒã˜æ•°å­—ã ã¨åˆ¤æ–­ã™ã‚‹è€ƒãˆæ–¹ã§ã™ã€‚TypeScript ã§ç°¡å˜ãªé–¢æ•°ã‚’ä½œæˆã—ã¦ã¿ã¾ã—ãŸã€‚

```ts
const nearlyEqual = (a: number, b: number, eps: number = 1e-9): boolean => {
    return Math.abs(a - b) <= eps;
}

nearlyEqual(0.1 + 0.2, 0.3) // true
```

`1e-9`ã¯$1 \times 10^{-9}$ã®ã“ã¨ã§ã€$0.000000001$ã¨ã„ã†å€¤ã‚’ç¤ºã—ã¾ã™ã€‚ã¤ã¾ã‚Šï¼’ã¤ã®æ•°å­—ã®å·®ãŒ$0.000000001$ä»¥ä¸‹ãªã‚‰åŒã˜æ•°å­—ã ã¨åˆ¤æ–­ã™ã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚

ä»–ã«ã¯`float`(32ãƒ“ãƒƒãƒˆ)ã˜ã‚ƒãªãã¦`double`**(64ãƒ“ãƒƒãƒˆ)ã§æ•°å­—ã‚’ä¿å­˜**ã™ã‚‹æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚`double`(64ãƒ“ãƒƒãƒˆ)ã ã¨ä»®æ•°éƒ¨ã®å®¹é‡ãŒ`float`(32ãƒ“ãƒƒãƒˆ)ã«æ¯”ã¹ã¦2å€ä»¥ä¸Šå¢—ãˆã‚‹ã®ã§ã€ãã®åˆ†æ­£ç¢ºã•ãŒä¸ŠãŒã‚Šã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/f5cbe5821d4d-20251017.png)
*double(64ãƒ“ãƒƒãƒˆ)ã§ä¿å­˜ã™ã‚‹å ´åˆ*

ä»®æ•°éƒ¨52ãƒ“ãƒƒãƒˆã®æœ€å¾Œã§åˆ‡ã‚Šä¸Šã’ãƒ»åˆ‡ã‚Šæ¨ã¦ã‚’ã™ã‚‹ã®ã§ã¾ã **æ­£ç¢ºãªå€¤ã§ã¯ã‚ã‚Šã¾ã›ã‚“**ãŒã€`float`(32ãƒ“ãƒƒãƒˆ)ã‚ˆã‚Šã‚‚ã£ã¨**æ­£ç¢ºåº¦ã®é«˜ã„å€¤ã‚’ä¿å­˜ã™ã‚‹**ã“ã¨ã¯ã§ãã¾ã™ã€‚ãã®åˆ†ãƒ¡ãƒ¢ãƒªå®¹é‡ã‚‚2å€ä½¿ã„ã¾ã™ãŒã€æœ€è¿‘ã¯ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®ã‚¹ãƒšãƒƒã‚¯ã‚‚è‰¯ããªã£ãŸã®ã§ãã“ã¾ã§æ°—ã«ãªã‚‹ç¯„å›²ã§ã¯ãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

ã¡ãªã¿ã« TypeScript ã§ã¯`float`ã‚‚`double`ã‚‚ãªãå¤§ä½“`number`ãŒä½¿ã‚ã‚Œã¦ã„ã¾ã™ãŒã€`number`ã‚‚64ãƒ“ãƒƒãƒˆã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚

## ğŸŒ· çµ‚ã‚ã‚Š

ã¡ã‚‡ã£ã¨ã—ãŸCSå‹‰å¼·ãƒ¡ãƒ¢ã§ã—ãŸã€‚

åœ°å‘³ã«æ—¥æœ¬èªã®æ•°å­¦ç”¨èªãŒé›£ã—ã„ã€æ­£ã®æ•°ãƒ»è² ã®æ•°ã¨ã‹å››æ¨äº”å…¥ã¨ã‹åˆã‚ã¦çŸ¥ã£ãŸ

