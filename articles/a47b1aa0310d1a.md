---
title: "husky ã‚’ v4 â†’ v7 ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ãŸã‚‰ pre-commit ãŒã§ããªããªã£ãŸ"
emoji: "ğŸ”¥"
type: "tech"
topics:
  - "npm"
  - "yarn"
  - "frontend"
  - "husky"
published: true
published_at: "2021-08-10 23:14"
---

ã¨æ€ã£ãŸã‚‰è¨­å®šæ–¹æ³•ãŒå¤‰ã‚ã£ãŸã ã‘ã ã£ãŸã®ã§ç›´ã—ã¾ã—ãŸç¬‘ã€ã¾ã§ãŒã‚¿ã‚¤ãƒˆãƒ«ã§ã™ï¼ˆé•·ã„ï¼‰

## 1. husky ã¨ã¯

![](https://storage.googleapis.com/zenn-user-upload/3174f5bf559c6bc9fb57b9e4.png)

ãƒ¯ãƒ³ã¡ã‚ƒã‚“ã‹ãªâ€¦

å®Ÿã¯ç§ä»Šã¾ã§ husky ãŒä½•ãªã®ã‚ã¾ã‚Šã‚ã‹ã£ã¦ãªãã¦ã€ã‚³ãƒŸãƒƒãƒˆã™ã‚‹åº¦ã«ã€Œãªã‚“ã‹èµ°ã£ã¦ã‚‹ãªã€ã¨æ€ã£ã¦ãŸã ã‘ã§ã—ãŸã€‚ã§ã‚‚ä»Šå›ã¡ã‚ƒã‚“ã¨èª¿ã¹ã¾ã—ãŸã‚ˆï¼

husky ã¨ã¯ã€**[git hook](https://git-scm.com/book/ja/v2/Git-%E3%81%AE%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA-Git-%E3%83%95%E3%83%83%E3%82%AF) ã‚’ç°¡å˜ã«æ“ä½œã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãã‚Œã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸**ã§ã™ã€‚

git ã§ã¯**ã‚³ãƒŸãƒƒãƒˆã‚„ãƒ—ãƒƒã‚·ãƒ¥ãªã©ç‰¹å®šã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒç™ºç”Ÿã—ãŸæ™‚ã«ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å©ã**æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚ãã‚ŒãŒ git hook ã§ã™ã€‚ãƒ•ãƒƒã‚¯ã‚’ã‹ã‘ã‚‹ã“ã¨ã®ã‚ˆã†ã«ç‰¹å®šã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ç‰¹å®šã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ã‹ã‘ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã­ã€‚

git hook ã‚’ä½¿ã†ãŸã‚ã«ã¯`.git/hooks`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ›¸ãå¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€husky ã‚’ä½¿ã†ã¨ã‚‚ã£ã¨æ¥½ã« git hook ã‚’åˆ¶å¾¡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```json
// package.json

{
  "husky": {
    "hooks": {
      "pre-commit": "yarn lint",
      "pre-push": "yarn test",
    }
  }
}
```

ç°¡å˜ã§ã—ã‚‡ã†ï¼Ÿ

## 2. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

husky ãŒä½•ãªã®ã‹ã‚ã‹ã£ãŸã®ã§ã•ã£ãã v4 ã‹ã‚‰ v7 ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚ãã®ãŸã‚ã«ã¯ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¿…è¦ã§ã€ã‚„ã‚Šæ–¹ã¯[å…¬å¼ã‚µã‚¤ãƒˆ](https://github.com/typicode/husky-4-to-7)ã«ã®ã£ã¦ã¾ã™ã€‚åŸºæœ¬çš„ã«ã‚³ãƒãƒ³ãƒ‰å©ãã ã‘ã§å¤§ä¸ˆå¤«(ãªã¯ãš)ã§ã™ã€‚

**npm**
```bash
npm install husky@latest --save-dev \
  && npx husky-init \
  && npm exec -- github:typicode/husky-4-to-7 --remove-v4-config 
```

**Yarn 1**
```bash
yarn add husky@latest --dev \
  && npx husky-init \
  && npm exec -- github:typicode/husky-4-to-7 --remove-v4-config
```

**Yarn 2**
```bash
yarn add husky@latest --dev \
  && yarn dlx husky-init --yarn2 \
  && npm exec -- github:typicode/husky-4-to-7 --remove-v4-config
```

**pnpm**
```bash
pnpm install husky@7 --save-dev \
  && pnpx husky-init \
  && pnpx -- github:typicode/husky-4-to-7 --remove-v4-config
```

ã¡ãªã¿ã«ç§ã®ç’°å¢ƒã¯ Yarn 1 ã§ã—ãŸã€‚

ã‚³ãƒãƒ³ãƒ‰å©ã„ã¦å‡¦ç†ãŒèµ°ã‚Šçµ‚ã‚ã£ãŸã‚‰ package.json ã«ä»¥ä¸‹ã®ã‚ˆã†ãªå·®åˆ†ãŒã§ãã¾ã™ã€‚

```json
// package.json

{
  "scripts": {
    // ...
    "prepare": "husky install" // æ–°ã—ãè¿½åŠ 
  },
  "devDependencies": {
    // ...
    "husky"' "^7.0.0", // 4.x.x ã‹ã‚‰ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰
    // ...
  },
  "husky": {
    "hooks": {
      "pre-commit": "yarn lint",
      "pre-push": "yarn test",
    }
  }
}
```
ãã—ã¦ã‚‚ã†ã²ã¨ã¤ç›®ç«‹ã¤å¤‰åŒ–ã¯ã€`.husky`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã«`pre-commit`ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒã§ãã¦ã„ã‚‹ã“ã¨ã§ã™ã€‚ä¸­èº«ã¯ã“ã‚Œã§ã™ã€‚
```bash
# .husky/pre-commit

#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

npm test
```

ã¾ãšã“ã“ã¾ã§ã‚„ã£ã¨ã„ã¦ã‚³ãƒŸãƒƒãƒˆã—ã¦ã¿ãŸã‚‰ã€ã‚‚ã¨ã‚‚ã¨æŒ‡å®šã—ã¦ãŸ`yarn lint`ã˜ã‚ƒãªãã¦`yarn test`ãŒèµ°ã£ã¦ãƒ“ãƒƒã‚¯ãƒªã—ã¾ã—ãŸã€‚

## 3. v7ã®è¨­å®šæ–¹æ³•

ãªã‚“ã‹ v7 ã‹ã‚‰ã¯è¨­å®šæ–¹æ³•ãŒå¤‰ã‚ã£ãŸã‚‰ã—ã„ã§ã™ã­ã€‚[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://typicode.github.io/husky/#/?id=package-scripts)ã«ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒˆã‚‚ã‚ã‚Šã¾ã—ãŸã€‚

```json
// .huskyrc.json (v4)
{
  "hooks": {
    "pre-commit": "npm test && npm run foo"
  }
}
```
```bash
# .husky/pre-commit (v7)
# ...
npm test
npm run foo
```
ã‚ãƒ¼ãªã‚‹ã»ã©ãƒ¼**ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ package.json ã«æ›¸ãã‚“ã˜ã‚ƒãªãã¦åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ã**ã‚ˆã†ã§ã™ã­ã€‚ã ã‹ã‚‰ã‚µãƒ³ãƒ—ãƒ«ã§`pre-commit`ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ã¦ãã‚ŒãŸã‚“ã§ã—ã‚‡ã†ã€‚

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç›´å¾Œã¯`.husky`é…ä¸‹ã«`pre-commit`ã—ã‹ãªã‹ã£ãŸã®ã§ç›´æ¥`pre-push`ã‚’è¿½åŠ ã—ã€ãã‚Œãã‚Œã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å…¥ã‚Œã¾ã—ãŸã€‚
```bash
# .husky/pre-commit

#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

yarn lint
```
```bash
# .husky/pre-push

#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

yarn test
```

ãã—ã¦ **pacakge.json ã«æ›¸ã„ã¨ã„ãŸ husky ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆéƒ¨åˆ†ã¯å‰Šé™¤**ã—ã¦è©¦ã—ã¦ã¿ãŸã‚‰ã€ã‚³ãƒŸãƒƒãƒˆå‰ã«ã¯`yarn lint`ãŒã€ãƒ—ãƒƒã‚·ãƒ¥å‰ã«ã¯`yarn test`ãŒèµ°ã£ãŸã®ã§ä¸Šæ‰‹ãã„ã£ãŸã¨æ€ã„ã¾ã™ã€‚

æœ€åˆã‚³ãƒŸãƒƒãƒˆã—ãŸã¨ãã«`yarn test`ãŒèµ°ã£ãŸã®ã¯`pre-commit`ã®ä¸­ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§`npm test`ãŒå…¥ã£ã¦ã‹ã‚‰ã ã£ãŸã¨æ€ã„ã¾ã™ã€‚ã¡ã‚ƒã‚“ã¨ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ã‹ã‚‰ä½¿ã†ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚

## çµ‚ã‚ã‚Š
ãªã‚“ã‹æ‰‹æ¢ã‚Šã§è§£æ±ºã—ãŸæ„Ÿã˜ãŒã‚ã‚‹ã®ã§ã©ã“ã‹é–“é•ã£ã¦ã‚‹ãªã‚‰ãœã²ã”æŒ‡æ‘˜ãŠé¡˜ã„ã—ã¾ã™ï¼ï¼