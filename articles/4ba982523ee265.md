---
title: "TypeScript はどうやって実行されるか理解する"
emoji: "🐥"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["typescript", "javascript"]
published: false
---

# 🌼 はじめに

# 1. 前提知識

## 1-1. 高水準言語 & 低水準言語

### 高水準言語

高水準言語（High-level language）は、**人**が理解しやすい自然言語に近づけて作られた言語です。

例で偶数と奇数をトータルで10回出力しているC言語のコードを見てみましょう。

```c
#include <stdio.h>

int main(void) {
  for (int i = 1; i <= 10; i++) {
    if (i % 2 == 0) printf("%d: even\n", i);
    else            printf("%d: odd\n", i);
  }
  return 0;
}
```

今後10回じゃなくて15回に出力に変更したい、ってなったら `i <= 10` の数字を直せばいいでしょう。 このように高水準言語は読みやすく、操作が簡単なという利点があります。

### 低水準言語

低水準言語（low-level language）は、**コンピュータ**が理解しやすいように作られた言語で、一般的に、機械語とアセンブリ言語を指します。

機械語（machine language）は CPU が直接実行する0と1の列で、完全に機会に向けの言語です。

```text
01001000 11000111 11000000 00000001 00000000 00000000 00000000
01001000 10000011 11000000 00000010
11000011
```

私が青少年のときよく聞いてた曲に0と1で構成されたデジタル世界がなんとかの歌詞がありましたが、それって機械語のことだったかーと今になって思います笑。



## 1-2. Compile & Interpreter




```asm
    .section .rodata
Leven:  .string "%d: even\n"
Lodd:   .string "%d: odd\n"

    .text
    .globl main
main:
    push   %rbp
    mov    %rsp, %rbp
    sub    $16, %rsp
    movl   $1, -4(%rbp)

.Lloop:
    cmpl   $10, -4(%rbp)
    jg     .Lend

    mov    -4(%rbp), %eax
    and    $1, %eax
    jne    .Loddprint

    mov    -4(%rbp), %esi
    lea    Leven(%rip), %rdi
    xor    %eax, %eax
    call   printf@PLT
    jmp    .Linc

.Loddprint:
    mov    -4(%rbp), %esi
    lea    Lodd(%rip), %rdi
    xor    %eax, %eax
    call   printf@PLT

.Linc:
    addl   $1, -4(%rbp)
    jmp    .Lloop

.Lend:
    mov    $0, %eax
    leave
    ret
```



# 2. TypeScript が動くまでの道

## 2-1. TypeScript を作成する

```ts
type Lang = 'ko' | 'ja' | 'en';

type User = {
    name: string;
    lang?: Lang;
};

const GREETINGS = {
    ko: '안녕하세요',
    ja: 'こんにちは',
    en: 'Hello',
} as const

function greet(user: User): string {
    const lang: Lang = user.lang ?? 'en';
    return `${GREETINGS[lang]}, ${user.name}!`;
}

(function main() {
    const me: User = { name: 'TS', lang: 'en' };
    console.log(greet(me));
})();
```

## 2-2. ビルド

```js
const GREETINGS = {
    ko: '안녕하세요',
    ja: 'こんにちは',
    en: 'Hello',
};
function greet(user) {
    const lang = user.lang ?? 'en';
    return `${GREETINGS[lang]}, ${user.name}!`;
}
(function main() {
    const me = { name: 'TS', lang: 'en' };
    console.log(greet(me));
})();
export {};
//# sourceMappingURL=hello.js.map
```

## 2-3. ランタイムで実行


```text
  ...(たくさんのコード)
  
   23 S> 0x1ebcfeaf69e8 @    0 : 2d 06 00 00       GetNamedProperty a3, [0], [0]
         0x1ebcfeaf69ec @    4 : c4                Star0 
  128 S> 0x1ebcfeaf69ed @    5 : 13 01             LdaConstant [1]
         0x1ebcfeaf69ef @    7 : c0                Star4 
  128 E> 0x1ebcfeaf69f0 @    8 : 62 04 f6 02       CallUndefinedReceiver1 a1, r4, [2]
         0x1ebcfeaf69f4 @   12 : c1                Star3 
   71 S> 0x1ebcfeaf69f5 @   13 : 2d f7 02 04       GetNamedProperty r3, [2], [4]
         0x1ebcfeaf69f9 @   17 : c3                Star1 
  101 S> 0x1ebcfeaf69fa @   18 : 2d f7 03 06       GetNamedProperty r3, [3], [6]
         0x1ebcfeaf69fe @   22 : c2                Star2 
  172 S> 0x1ebcfeaf69ff @   23 : 11                LdaTrue 
         0x1ebcfeaf6a00 @   24 : c0                Star4 
  172 E> 0x1ebcfeaf6a01 @   25 : 62 f9 f6 08       CallUndefinedReceiver1 r1, r4, [8]
  207 S> 0x1ebcfeaf6a05 @   29 : 61 f8 0a          CallUndefinedReceiver0 r2, [10]
  293 S> 0x1ebcfeaf6a08 @   32 : 78 04 0c 00       CreateRegExpLiteral [4], [12], #0
         0x1ebcfeaf6a0c @   36 : c0                Star4 
         0x1ebcfeaf6a0d @   37 : 13 05             LdaConstant [5]
         0x1ebcfeaf6a0f @   39 : bf                Star5 
  293 E> 0x1ebcfeaf6a10 @   40 : 63 fa f6 f5 0d    CallUndefinedReceiver2 r0, r4, r5, [13]
  721 S> 0x1ebcfeaf6a15 @   45 : 13 06             LdaConstant [6]
         0x1ebcfeaf6a17 @   47 : bf                Star5 
  721 E> 0x1ebcfeaf6a18 @   48 : 62 04 f5 0f       CallUndefinedReceiver1 a1, r5, [15]
         0x1ebcfeaf6a1c @   52 : c0                Star4 
  759 E> 0x1ebcfeaf6a1d @   53 : 2d f6 07 11       GetNamedProperty r4, [7], [17]
         0x1ebcfeaf6a21 @   57 : c0                Star4 
  766 E> 0x1ebcfeaf6a22 @   58 : 2d f6 08 13       GetNamedProperty r4, [8], [19]
         0x1ebcfeaf6a26 @   62 : c1                Star3 
  783 E> 0x1ebcfeaf6a27 @   63 : 2d 03 09 15       GetNamedProperty a0, [9], [21]
         0x1ebcfeaf6a2b @   67 : bf                Star5 
         0x1ebcfeaf6a2c @   68 : 0d 01             LdaSmi [1]
  787 E> 0x1ebcfeaf6a2e @   70 : 2f f5 17          GetKeyedProperty r5, [23]
         0x1ebcfeaf6a31 @   73 : bf                Star5 
  767 E> 0x1ebcfeaf6a32 @   74 : 5e f7 f6 f5 19    CallProperty1 r3, r4, r5, [25]
         0x1ebcfeaf6a37 @   79 : 0e                LdaUndefined 
  792 S> 0x1ebcfeaf6a38 @   80 : a9                Return 
  
  ...(たくさんのコード)
```

# 3. ビルドとランタイムの疎結合


# 4. TSGO 出るってよ

# 🌷 終わり
